$(document).ready(function(){const amountFreeProduct=document.querySelector("[data-treshold-product]")?document.querySelector("[data-treshold-product]").getAttribute("data-treshold-product"):null;var cart_total=$(".gb-totals-total-value").first().text();amountFreeProduct>0&&show_progress_bar&&(setTimeout(function(){var cart_total2=$(".gb-totals-total-value").first().text();cart_total2>=amountFreeProduct?$(".cart-item").hasClass("gb-find-remove-product")?console.log("Free product already in cart"):(console.log("Adding free product"),$(".gb-free-product-trigger").trigger("click")):(console.log("Removing free product - under threshold"),$(".gb-remove-product").trigger("click"))},3e3),$("body").on("click",".gb-sumbit-free",function(){setTimeout(function(){cart_total>=amountFreeProduct?$(".cart-item").hasClass("gb-find-remove-product")||$(".gb-free-product-trigger").trigger("click"):$(".gb-remove-product").trigger("click")},3e3)})),$("body").on("click",".gb-shipping-protection-button label.switch",async e=>{if(e.target.tagName=="INPUT")return;const curElem=document.querySelector(".gb-shipping-protection-button label.switch"),curInputElem=document.querySelector(".gb-shipping-protection-button label.switch input"),spinAnim=document.querySelector(".gb-shipping-protection-button .spin-animation"),checkElem=document.querySelector(".gb-shipping-protection-button .complete-check");if(curElem.classList.contains("unchecked")&&!curInputElem.checked){if(spinAnim.style.display=="block"||curInputElem.checked)return;const form=document.querySelector("form.shipping-protection-form"),formData=new FormData(form);if(!formData.get("id")){console.error("There is no shipping protection product selected. Please select the shipping product in the global theme settings");return}spinAnim.style.display="block";try{(await fetch(routes.cart_add_url,{method:"POST",body:formData,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).ok&&(spinAnim.style.display="none",checkElem.style.display="block")}catch(err){console.error("error at shipping protection form submission",err)}fetch(routes.cart_url+"?view=drawer").then(response=>response.text()).then(html=>{const cartDrawer=document.querySelector("#CartDrawer"),newCartDrawer=parser.parseFromString(html,"text/html").querySelector("#CartDrawer");cartDrawer&&newCartDrawer&&updateCartDrawer(cartDrawer,newCartDrawer,!0,()=>{curElem.classList.remove("unchecked"),curElem.classList.add("checked"),curInputElem.checked=!0})}).catch(_err=>{curElem.classList.remove("unchecked"),curElem.classList.add("checked"),curInputElem.checked=!0})}else if(curElem.classList.contains("checked")&&curInputElem.checked){checkElem.style.display="none";const cartDrawer=document.querySelector("#CartDrawer"),removeButton=cartDrawer.querySelector(`cart-remove-button[data-id="${shippingProductId}"]`),shippingItemIndex=removeButton?.dataset.index;if(!removeButton||!shippingItemIndex)return;const cartItems=cartDrawer.querySelector("cart-items")||cartDrawer.querySelector("cart-drawer-items"),event=new CustomEvent("remove-shipping-protection",{detail:null});cartItems.updateQuantity(shippingItemIndex,0,event,"","",()=>{curElem.classList.remove("checked"),curElem.classList.add("unchecked"),curInputElem.removeAttribute("checked")})}}),$("body").on("change",".gb-change-variant_id",function(){var id_change=$(this).find(":selected").attr("data-variant-id");if(!id_change){console.error("No data-variant-id found on selected option");return}$(this).closest(".gb-get-main-freq-pro").find(".product-variant-id").val(id_change)})}),document.addEventListener("change",function(e){if(e.target.matches(".cart-drawer .gbfrequently-bought-with-main-whole .select__select")){const parentBlock=e.target.closest(".gb-get-main-freq-pro");if(!parentBlock){console.log("Error: Could not find parent block");return}const allValues=Array.from(parentBlock.querySelectorAll(".select__select")).map(sel=>sel.value).join(" / "),variantSelect=parentBlock.querySelector('[name="variants"]');if(!variantSelect){console.log("Error: Could not find variant selector");return}const matchedOption=Array.from(variantSelect.options).find(option=>option.text.includes(allValues)),idInput=parentBlock.querySelector('[name="id"]');if(!idInput){console.log("Error: Could not find id input field");return}matchedOption?(console.log("Matched variant option value:",matchedOption.value),idInput.value=matchedOption.value,console.log("Set ID input value to:",idInput.value)):console.log("No matching variant found for:",allValues)}}),document.addEventListener("submit",function(e){if(e.target.action&&e.target.action.includes("/cart/add")){const idInput=e.target.querySelector('[name="id"]');if(!idInput||!idInput.value)return console.log("Preventing submission - missing id parameter"),e.preventDefault(),!1}}),$(document).ready(function(){$(".cart-item .quantity__button, .cart-item .quantity__input").on("click change input",function(){const cartItem=$(this).closest(".cart-item"),variantId=$(this).closest(".quantity-input").find(".quantity__input").data("quantity-variant-id");if($(this).closest("form").length>0){let idInput=$(this).closest("form").find('input[name="id"]');idInput.length===0&&variantId?(console.log("Adding missing ID input to cart form"),$("<input>").attr({type:"hidden",name:"id",value:variantId}).appendTo($(this).closest("form"))):idInput.length>0&&variantId&&idInput.val(variantId)}}),$("#CartDrawer-Checkout").on("click",function(e){const form=$("#CartDrawer-Form");if(form.length===0)return;const cartItems=form.find(".cart-item");if(cartItems.length===0)return console.log("No items in cart, preventing checkout"),e.preventDefault(),!1;console.log("Cart checkout with",cartItems.length,"items")}),$(document).on("keydown",".quantity__input",function(e){(e.key==="Enter"||e.keyCode===13)&&(e.preventDefault(),$(this).trigger("blur"))})}),$(document).ready(function(){$(".gbfrequently-bought-with-main-whole button, .gbfrequently-bought-with-main-whole .gb-sumbit-free, .gb-free-product-trigger, .gb-product-shipping-protection-product-tirgger, .gb-product-sticky-add-to-cart-form").on("click",function(e){const parentBlock=$(this).closest(".gb-get-main-freq-pro, form");if(!parentBlock){console.error("Could not find parent block for frequently bought product");return}let productId=null;const idInput=parentBlock.find('input[name="id"]');if(idInput.length>0&&idInput.val())productId=idInput.val();else if(parentBlock.find(".gb-change-variant_id").length>0){const selectedOption=parentBlock.find(".gb-change-variant_id option:selected");selectedOption.length>0&&(productId=selectedOption.data("variant-id"))}else parentBlock.find(".product-variant-id").length>0?productId=parentBlock.find(".product-variant-id").val():$(this).data("variant-id")&&(productId=$(this).data("variant-id"));if(console.log("Frequently bought product add to cart - ID:",productId),this.classList.contains("gb-free-product-trigger")&&!show_progress_bar)return;if(!productId)return console.error("Missing product ID for frequently bought product"),e.preventDefault(),!1;idInput.length===0?(console.log("Adding missing ID input to frequently bought product form"),$("<input>").attr({type:"hidden",name:"id",value:productId}).appendTo(parentBlock)):idInput.val(productId);let quantityInput=parentBlock.find('input[name="quantity"]');quantityInput.length===0?(console.log("Adding default quantity input to frequently bought product form"),$("<input>").attr({type:"hidden",name:"quantity",value:1}).appendTo(parentBlock)):(!quantityInput.val()||quantityInput.val()<1)&&quantityInput.val(1)})});
//# sourceMappingURL=/cdn/shop/t/5/assets/custom.js.map?v=71609619958355010901760201383
